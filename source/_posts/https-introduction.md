---
title: HTTPS 浅析
date: 2019-02-25 16:57:31
tags: [https, 对称加密, 非对称加密]
---

![https](./https.png)

### 对称加密

最初的加密方式采用对称加密，多个客户端使用相同的密钥，这样无异于没有假面，黑客可以作为客户端之一得到密钥，所有的信息将会被暴露无遗。实际应用中，采用的是多个客户端多个对称密钥的策略，但是协商加密算法的过程仍然是明文的形式传递，难以保证信息传输过程中的安全性

### 非对称加密

私钥加密后的密文，只要是公钥，都可以解密，但是公钥加密后的密文，只有私钥可以解密。私钥只有一个人有，公钥可以发给所有人。
总结如下：

- 公钥是开放给所有人的，但私钥是需要保密的，存在服务端
- 服务端客户端信息传输是不安全的，因为所有人都可以获取公钥
- 但客户端向服务端的信息传输却是安全的，因为私钥只有服务端存在。

信息通信采用 http 是不安全的，存在信息劫持，篡改的风险，https 是加密传输，采用非对称加密的方法对加密方法的商议过程进行加密，需要客户端持有服务器的公钥。

**问题就出现了：
进行非对称加密，前提是客户端需要拥有服务器端的公钥，在公钥发放过程中，存在劫持和篡改的危险，一旦出现，后续通信都是利用假密钥和其他服务器进行通讯**

### 如何安全地获取公钥，确保公钥是正确？

这里需要用到 SSL 证书和 CA 机构

当客户端访问服务器时，服务器发送给 SSL 证书给客户端，SSL 证书中包含的具体内容有证书的颁发机构、有效期、公钥、证书持有者、签名，通过第三方的校验保证了身份的合法，解决了公钥获取的安全性

以浏览器为例说明如下整个的校验过程：

1. 首先浏览器读取证书中的证书所有者、有效期等信息进行一一校验
2. 浏览器开始查找操作系统中已内置的受信任的证书发布机构 CA，与服务器发来的证书中的颁发者 CA 比对，用于校验证书是否为合法机构颁发
3. 如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的。
4. 如果找到，那么浏览器就会从操作系统中取出 颁发者 CA 的公钥，然后对服务器发来的证书里面的数字签名进行解密得到摘要
5. 浏览器使用相同的 hash 算法计算出服务器发来的证书中的明文摘要值，将这个计算的摘要与证书中签名解密的值做对比
   ![校验](./check.png)
6. 对比结果一致，则证明服务器发来的证书合法，没有被冒充
7. 此时浏览器就可以读取证书中的公钥，用于后续加密了

### 总结

HTTPS 要使客户端与服务器端的通信过程得到安全保证，必须使用的对称加密算法，但是协商对称加密算法的过程，需要使用非对称加密算法来保证安全，然而直接使用非对称加密的过程本身也不安全，会有中间人篡改公钥的可能性，所以客户端与服务器不直接使用公钥，而是使用数字证书签发机构颁发的证书来保证非对称加密过程本身的安全。这样通过这些机制协商出一个对称加密算法，就此双方使用该算法进行加密解密。从而解决了客户端与服务器端之间的通信安全问题。

**SSL 证书采用加密证书的方式，CA 证书的演变过程可以阅读参考文章[[2]](https://www.cnblogs.com/shijingjing07/p/5965792.html)**

### 参考文章

#### https

[1]http://www.cnblogs.com/jiftle/p/7942508.html

#### 公钥私钥和 CA

[2]https://www.cnblogs.com/shijingjing07/p/5965792.html

[3]http://www.youdzone.com/signature.html

[4]https://blog.51cto.com/11883699/2160032

#### CA 证书

[5]https://www.cnblogs.com/handsomeBoys/p/6556336.html
